# 单周期CPU 设计文档

## IFU（取指令单元）

**模块描述：**
包含PC、NPC、IM三个子模块
（此处填写模块功能、内部结构、实现要点等）



###  PC（Program Counter）模块 

**模块功能简述：**

+ PC 模块保存当前执行的指令地址，在每个时钟周期根据控制信号更新为 next_PC 或保持不变

+ PC具有异步复位的功能，复位值为起始地址**0x00003000**

| 端口名       | 功能说明              | 位宽 | 方向 | 模块     |
| ------------ | --------------------- | ---- | ---- | -------- |
| **clk**      | 时钟信号              | 1    | I   | IFU      |
| **reset**    | 异步复位信号，清零 PC | 1    | I   | IFU      |
| **DI[31:0]** | 输入                  | 32   | I   | IFU      |
| **DO[31:0]** | 当前 PC 输出          | 32   | O     | IM / IFU |

### NPC(next program counter) 模块 
+ NPC模块根据当前PC模块输出的当前指令，计算下一条指令的地址
+ 如果是顺序执行类指令，则进行PC+4
+ 如果是分支指令beq
    + 若rs与rt相等(zero==1)，则输出PC+4+立即数；否则输出PC+4

| 端口名       | 功能说明              | 位宽 | 方向 | 连接模块     |
| ------------ | --------------------- | ---- | ---- | -------- |
| **PC[31:0]**      | 当前指令地址              | 32   | I   | PC      |
| **imm[15:0]**    | 16位的指令行偏移 | 16    | I   | IM      |
| **br** | beq分支指令标志     | 1   | I   | IM      | 
| **zero** | rs==rt         | 1   | I     | IM  |
| **NPC[31:0]** | 下一条指令地址 | 32 | I | PC |

### IM（Instruction Memory）模块 

**模块功能简述：**
 IM 模块根据输入的地址输出对应的机器指令，用 ROM 实现。
 + 容量为 4096（字 word） × 32bit，即存储了4096条指令(4096 =  2 ^ 12)
    + 所以ROM的地址宽度为12
+ 每个地址相差4，所以除以4（右移两位）可得到第几行指令

| 端口名      | 功能说明                   | 位宽 | 方向 | 连接模块 |
| ----------- | -------------------------- | ---- | ---- | -------- |
| **IM_addr[31:0]** | 指令地址输入（来自 PC）    |   32   |   I   | PC / IFU |
| **IM_data[31:0]** | 输出对应地址的指令内容     |   32   |   O   | IFU      |




---



## GRF（通用寄存器组）

**模块描述：**
（此处填写模块功能、读写端口设计、复位行为等）

### 模块接口

| 端口名     | 方向 | 位宽 | 功能说明 |
| :------ | :- | :- | :--- |
| `A1[4:0]`    |  I  |  5  |  读到RD1的地址    |
| `A2[4:0]`    |  I  |  5  |  读到RD2的地址    |
| `A3[4:0]`    |  I  |  5  |  写入地址    |
| `WD[31:0]`    |  I  |  5  |   写入数据   |
| `RD1[31:0]`   |  O |  32  |  读出的数据1     |
| `RD2[31:0]`   |  O  |  32  |  读出的数据2    |
| `WE`    |  I  |  1  |  写入使能信号    |
| `Clk`   |  I  |  1  |  时钟信号    |
| `Reset` |  I  |  1  | 异步复位     |

### 功能定义

| 功能项        | 
| :--------- | 
| 寄存器写入      | 
| 异步复位       | 
| 读出端口       |
| $0号寄存器常为0$ |

---

## ALU（算术逻辑单元）

**模块描述：**
支持 ADDU SUBU ORI LW SW BEQ 几个指令
集成方法：只需要使用加法、或者、判0模块即可

### 模块接口

| 端口名       | 方向 | 位宽 | 功能说明 |
| :-------- | :- | :- | :--- |
| `A[31:0]`       |  In  |  32  | 输入1    |
| `B[31:0]`       |  In  |  32  | 输入2    |
| `ALUCtrl[1:0]` |  In  |  2  | 控制信号     |
| `Result`  |  Out  |  1  |  结果    |
| `Zero`    | Out   |  1  |  是否相等    |

### 功能定义

| 功能项  | 功能描述 |
| :--- | :--- |
| 加法   |      |
| 减法   |      |
| 逻辑或  |      |
| 大小比较 |      |

---

## DM（数据存储器）

**模块描述：**
存储程序的结果，能够读出存储器的数据
利用RAM实现，容量为3072 * 32bit，地址位宽为12
异步复位，初始化为0x00000000

### 模块接口

| 端口名        | 方向 | 位宽 | 功能说明 |
| :--------- | :- | :- | :--- |
| `Addr[4:0]`     | I   |    |      |
| `WD`       |  I  |    |      |
| `RD`       |  O  |    |      |
| `We` |    |  I   |      |
| `Clk`      |    |    |      |
| `Reset`    |    |    |      |

### 功能定义

| 功能项  | 
| :--- | 
| 读操作  |      
| 写操作  |      
| 异步复位 |     

---

## EXT（扩展单元）

**模块描述：**
将16位数进行0扩展为32位数

### 模块接口

| 端口名       | 方向 | 位宽 | 功能说明 |
| :-------- | :- | :- | :--- |
| `Imm16[15:0]`   |  I  |  16  |  16位输入    |
| `Ext[15:0]` |  I  |  16  |  32位0扩展结果    |


### 功能定义

| 功能项  | 功能描述 |
| :--- | :--- |
| 符号扩展 |  按照符号数进行扩展    |
| 零扩展  |   用0进行扩展   |

---

## Controller（控制器）

**模块描述：**
（此处填写控制信号生成逻辑、输入信号与输出控制信号的映射等）

### 模块接口

| 端口名              | 方向 | 位宽 | 功能说明 |
| :--------------- | :- | :- | :--- |
| `Opcode`         |    |    |      |
| `Funct`          |    |    |      |
| `ControlSignals` |    |    |      |
| `Branch`         |    |    |      |

### 功能定义

| 功能项     | 功能描述 |
| :------ | :--- |
| 主控制信号生成 |      |
| 分支控制    |      |
| 运算控制    |      |

---
