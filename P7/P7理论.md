# P7课下：

1. **用户态与内核态：**我们规定用户编写的程序只能进行用户态操作，内核态操作只能由操作系统自行执行。
2. **陷入内核**：临时将用户态切换为内核态，CPU 会先保存当前执行的现场（相当于设置了一个存档），并将 PC 切换到内核指令对应的地址。
3. **内部异常处理的**目标：能够正确**识别内部异常**，能够正确**跳转到内核地址**，并能够正确从内核中**跳转回原来的位置**。
4. **外部中断**：在任意一个时钟上升沿，无论当前在执行的是什么指令，只要收到外部中断，我们的 CPU 都需要立即陷入内核，并在执行完内核指令之后返回现场。
5. **宏观PC**：流水线CPU中固定观测指令的PC，作为CP0异常指令的输入值。宏观 PC 要等于 CP0 模块所在流水线级的 PC 值！
6. 


debug:
1. MWreg, NPC也需要导入IntReq信号，需要在陷入内核IntReq为真时停止。
2. F级使用D级的信号(d_eret)需要三个等号比较，一开始是高阻态！
3. DEreg 在clr(冻结)但不是reset req状态下的PC值的设置
4. 注意 mfc0 mtc0所需要的rs 不仅仅在M级需要传入，W级也需要！！
5. 当你发现明明内部信号改变，外部连接的信号没改变时，可能是latch 看一看这个信号有没有always里初始化！：eret没有默认情况，导致latch
6. MDU模块中乘除法操作和读写操作都需要在非intReq条件下
7. ALU里不能直接靠aluop来判断是否溢出异常，只有add sub addi load/save类需要，而且后者异常码分别为ADES ADEL
8. ADES部分错误 -- 考虑是地址范围的问题，可能多了东西，少了东西！--找出来了 上限范围有问题
   
>参考资料：https://kamonto.github.io/Kamonto_blog/2025/10/14/%E4%B8%80%E6%9C%AC%E4%B9%A6%E6%95%99%E4%BD%A0%E9%80%9A%E5%85%B3%E8%AE%A1%E7%BB%84%E5%AE%9E%E9%AA%8C%EF%BC%88%E4%B8%8B%EF%BC%89/#%E7%BB%88%E7%AB%A0%EF%BC%9A%E5%B8%A6%E4%B8%AD%E6%96%AD%E5%BC%82%E5%B8%B8%E7%9A%84%E4%BA%94%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF-CPU